<div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">制作充值卡</h3>
    </div>
    <div class="panel-body">
        <form method="post"  enctype="multipart/form-data" class="form-horizontal"  action="/recharge/save" onsubmit="return submit_model(this);" >
            <div class="form-group">
                <label  class="col-sm-2 control-label">任务名称：</label>
                <div class="col-sm-5">
                    <input type="text" class="form-control" name="name" placeholder="任务名称">
                </div>
            </div>
            <div class="form-group">
                <label  class="col-sm-2 control-label">金额：</label>
                <div class="col-sm-5">
                    <input type="text" class="form-control" name="money" placeholder="金额">
                </div>
            </div>
            <div class="form-group">
                <label  class="col-sm-2 control-label">制作数量：</label>
                <div class="col-sm-5">
                    <input type="text" class="form-control" name="num" placeholder="制作数量">
                </div>
            </div>
            <div class="form-group">
                <label  class="col-sm-2 control-label">充值限制：</label>
                <div class="col-sm-5">
                    限定每个用户总共可以充值&nbsp;<input type="text" style="width: 40px"  name="use_num" value="1" >&nbsp;张
                </div>
            </div>
            <div class="form-group">
                <label  class="col-sm-2 control-label">到期时间：</label>
                <div class="col-sm-5">
                    <div class="input-group date  col-md-10" data-link-field="dtp_input1" id="time" >
                        <input class="form-control" type="text" name="to_date" value="" placeholder="到期时间"  readonly>
                        <span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span>
                        <span class="input-group-addon"><span class="glyphicon glyphicon-th"></span></span>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label  class="col-sm-2 control-label">创建人员：</label>
                <div class="col-sm-5">
                    <input type="text" class="form-control" name="admin_name" readonly="readonly" value="<{$adminname}>">
                </div>
            </div>
            <div class="form-group">
                <div class="col-sm-offset-2 col-sm-10">
                    <input class="btn btn-primary" type="submit" value="提交">
                </div>
            </div>
        </form>
    </div>
</div>
<script>
    var today = '<{$today}>';
    $(function(){
        $('#time').datetimepicker({
            language: 'zh', //汉化
            minView: "month",
            autoclose: 1,
            format:'yyyy-mm-dd',      //格式化日期
            startDate: today,
            timepicker:false    //关闭时间选项
        });
    });

    function submit_model(obj){
        if($(obj).attr('lock') == 1){
            return false;
        }

        if(confirm('提交后无法修改，请再次仔细检查，确定提交？')){
            $(obj).attr('lock', 1);
            ajaxSubmit(obj, function(data){
                $(obj).attr('lock', 0);
                if(data.status=='success'){
                    alert('成功');
                    location.href='/recharge/index';
                }else{
                    alert(data.msg);
                    return false;
                }
            });
        }

        return false;
    }
    //将form转为AJAX提交
    function ajaxSubmit(frm, fn) {
        var dataPara = getFormJson(frm);
        $.ajax({
            url: frm.action,
            type: frm.method,
            data: dataPara,
            dataType:'json',
            success: fn
        });
    }

    //将form中的值转换为键值对。
    function getFormJson(frm) {
        var o = {};
        var a = $(frm).serializeArray();
        $.each(a, function () {
            if (o[this.name] !== undefined) {
                if (!o[this.name].push) {
                    o[this.name] = [o[this.name]];
                }
                o[this.name].push(this.value || '');
            } else {
                o[this.name] = this.value || '';
            }
        });
        return o;
    }
</script>