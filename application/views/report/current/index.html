<style type="text/css">
    .col-md-new{
        width: 12.5%;
    }
    .col-xs-6{
        padding: 0 5px;
    }
    .panel-body{
        padding:12px 10px;
    }
    .fixed-table-body thead th.eq_avg_td .th-inner{
        padding-bottom: 0;
        padding-top: 0;
    }
</style>
<div class="panel panel-default">
    <div class="panel-heading">
        <span class="panel-title" style="width: 50%; color: #777;font-size: 18px;"> 实时概况 </span>

        <select class="form-control" id="search_platform_id" name="search_platform_id" style="width: 200px;float: right;height: 30px;">
            <option value="-1">选择商户</option>
            <{foreach key=key item=item from=$platform_list}>
            <option value="<{$item['id']}>" <{if $platform_id eq $item['id']}>selected="selected"<{/if}>><{$item['name']}></option>
            <{/foreach}>
        </select>
        <span style="float: right;color: #777;margin-right: 20px">更新时间： <{$order['time']}></span>
    </div>

    <div class="panel-body">
        <div class="row">
            <div class="col-xs-6 col-md-new">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title glyphicon glyphicon-align-justify">支付金额</h3>
                    </div>
                    <div class="panel-body">
                        <{$order['money']}><br/> <span style="color: #777;font-size: 12px">昨日全天：<{$yesterday_order['money']}></span>
                        <br/> <span style="color: #777;font-size: 12px">上周同期：<{$last_order['money']}></span>
                    </div>
                </div>
            </div>
            <div class="col-xs-6 col-md-new">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title glyphicon glyphicon-align-justify">支付订单数</h3>
                    </div>
                    <div class="panel-body">
                        <{$order['num']}><br/> <span style="color: #777;font-size: 12px">昨日全天：<{$yesterday_order['num']}></span>
                        <br/> <span style="color: #777;font-size: 12px">上周同期：<{$last_order['num']}></span>
                    </div>
                </div>
            </div>
            <div class="col-xs-6 col-md-new">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title glyphicon glyphicon-align-justify">支付用户数</h3>
                    </div>
                    <div class="panel-body">
                        <{$order['user_num']}><br/> <span style="color: #777;font-size: 12px">昨日全天：<{$yesterday_order['user_num']}></span>
                        <br/> <span style="color: #777;font-size: 12px">上周同期：<{$last_order['user_num']}></span>
                    </div>
                </div>
            </div>
            <div class="col-xs-6 col-md-new">
                <div class="panel panel-default">
                    <div class="panel-heading" style="padding: 10px 10px">
                        <h3 class="panel-title glyphicon glyphicon-align-justify">商品销售件数</h3>
                    </div>
                    <div class="panel-body">
                        <{$order['qty']}><br/> <span style="color: #777;font-size: 12px">昨日全天：<{$yesterday_order['qty']}></span>
                        <br/> <span style="color: #777;font-size: 12px">上周同期：<{$last_order['qty']}></span>
                    </div>
                </div>
            </div>
            <div class="col-xs-6 col-md-new">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title glyphicon glyphicon-align-justify">客单价</h3>
                    </div>
                    <div class="panel-body">
                        <{$order['user_avg']}><span style="font-size: 10px;">[折前:</span><span style="font-size: 10px;"><{$order['after_user_avg']}>]</span><br/> <span style="color: #777;font-size: 12px">昨日全天:<{$yesterday_order['user_avg']}>[<{$yesterday_order['after_user_avg']}>]</span>
                        <br/> <span style="color: #777;font-size: 12px">上周同期:<{$last_order['user_avg']}>[<{$last_order['after_user_avg']}>]</span>
                    </div>
                </div>
            </div>
            <div class="col-xs-6 col-md-new">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title glyphicon glyphicon-align-justify">笔单价</h3>
                    </div>
                    <div class="panel-body">
                        <{$order['num_avg']}><br/> <span style="color: #777;font-size: 12px">昨日全天：<{$yesterday_order['num_avg']}></span>
                        <br/> <span style="color: #777;font-size: 12px">上周同期：<{$last_order['num_avg']}></span>
                    </div>
                </div>
            </div>
            <div class="col-xs-6 col-md-new">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title glyphicon glyphicon-align-justify">总库存数量</h3>
                    </div>
                    <div class="panel-body">
                        <{$order['stock']}><br/> <span style="color: #777;font-size: 12px">总SKU数量：<{$order['stock_p']}></span>
                        <br/> <span style="color: #777;font-size: 12px">&nbsp;</span>
                    </div>
                </div>
            </div>
            <div class="col-xs-6 col-md-new">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title glyphicon glyphicon-align-justify">动销率</h3>
                    </div>
                    <div class="panel-body">
                        <{$order['stock_avg']}><br/> <span style="color: #777;font-size: 12px">昨日全天：<{$yesterday_order['stock_avg']}></span>
                        <br/> <span style="color: #777;font-size: 12px">上周同期：<{$last_order['stock_avg']}></span>
                    </div>
                </div>
            </div>
            <div class="col-xs-6 col-md-new">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title glyphicon glyphicon-align-justify">注册用户数</h3>
                    </div>
                    <div class="panel-body" style="padding: 2px 12px;">
                        <{$order['reg_user']}><br>
                        <span style="color: #777;font-size: 10px;" >来自新设备：<{$order['reg_user_new']}></span><br/>
                        <span style="color: #777;font-size: 10px">昨日全天：<{$yesterday_order['reg_user']}></span>
                        <br/> <span style="color: #777;font-size: 10px">上周同期：<{$last_order['reg_user']}></span>
                    </div>
                </div>
            </div>
            <div class="col-xs-6 col-md-new">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title glyphicon glyphicon-align-justify">开门用户数</h3>
                    </div>
                    <div class="panel-body">
                        <{$order['open_user_num']}><br/> <span style="color: #777;font-size: 12px">昨日全天：<{$yesterday_order['open_user_num']}></span>
                        <br/> <span style="color: #777;font-size: 12px">上周同期：<{$last_order['open_user_num']}></span>
                    </div>
                </div>
            </div>
            <div class="col-xs-6 col-md-new">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title glyphicon glyphicon-align-justify">开门次数</h3>
                    </div>
                    <div class="panel-body">
                        <{$order['open_num']}><a href="javascript:void(0);" id = 'show_refer' style="font-size: 10px;">查看来源分布</a><br/> <span style="color: #777;font-size: 12px">昨日全天：<{$yesterday_order['open_num']}></span>
                        <br/> <span style="color: #777;font-size: 12px">上周同期：<{$last_order['open_num']}></span>
                    </div>
                </div>
            </div>

            <div class="col-xs-6 col-md-new">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title glyphicon glyphicon-align-justify">上架商品</h3>
                    </div>
                    <div class="panel-body">
                        <{$order['deliver_up']}><br/> <span style="color: #777;font-size: 12px">昨日全天：<{$yesterday_order['deliver_up']}></span>
                        <br/> <span style="color: #777;font-size: 12px">上周同期：<{$last_order['deliver_up']}></span>
                    </div>
                </div>
            </div>
            <div class="col-xs-6 col-md-new">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title glyphicon glyphicon-align-justify">下架商品</h3>
                    </div>
                    <div class="panel-body">
                        <{$order['deliver_down']}><br/> <span style="color: #777;font-size: 12px">昨日全天：<{$yesterday_order['deliver_down']}></span>
                        <br/> <span style="color: #777;font-size: 12px">上周同期：<{$last_order['deliver_down']}></span>
                    </div>
                </div>
            </div>
            <div class="col-xs-6 col-md-new">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title glyphicon glyphicon-align-justify" style="font-size: 15px">新运营设备数</h3>
                    </div>
                    <div class="panel-body">
                        <{$order['new_eq']}><br/> <span style="color: #777;font-size: 12px">昨日全天：<{$yesterday_order['new_eq']}></span>
                        <br/> <span style="color: #777;font-size: 12px">上周同期：<{$last_order['new_eq']}></span>
                    </div>
                </div>
            </div>
            <div class="col-xs-6 col-md-new">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title glyphicon glyphicon-align-justify">营销补贴额</h3>
                    </div>
                    <div class="panel-body">
                        <{$order['discounted_money']}><br/> <span style="color: #777;font-size: 12px">昨日全天：<{$yesterday_order['discounted_money']}></span>
                        <br/> <span style="color: #777;font-size: 12px">上周同期：<{$last_order['discounted_money']}></span>
                    </div>
                </div>
            </div>

            <div class="col-xs-6 col-md-new">
                <div class="panel panel-default">
                    <div class="panel-heading" style="padding: 10px 10px">
                        <h3 class="panel-title glyphicon glyphicon-align-justify">待处理售后数</h3>
                    </div>
                    <div class="panel-body">
                        <{$order['refund_num']}><br/> <span style="color: #777;font-size: 12px">超过3天未处理：<{$order['three_refund_num']}></span>
                        <br/> <span style="color: #777;font-size: 12px">&nbsp;</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="panel-body">
        <div id="main" style="width: 100%;height:300px;"></div>
    </div>

    <div class="panel-body">
        <div id="main2" style="width: 100%;height:300px;"></div>
    </div>


    <div class="panel-heading">
        <span class="panel-title" style="width: 50%; color: #777;"> 设备销量排行 </span>
    </div>

    <div class="panel-body">
        <div id="config-body">
            <table id="config-table" data-sort-order="desc" data-toggle="table" data-sort-stable="true"  data-url="/report/current/eq_table?platform_id=<{$platform_id}>" data-pagination="true" data-side-pagination="server"  data-page-size="30" >
                <thead>
                <tr>
                    <th data-field="key" data-align="left">排名</th>
                    <th data-field="eq_name" data-align="left">设备名称</th>
                    <th data-field="money" data-align="left" data-sortable="true" data-order="desc" data-class="eq_avg_td" >实付金额<br><span style="font-size: 10px;font-weight: normal;color: #777" id="avg_money">平均：0</span></th>
                    <th data-field="num" data-align="left" data-sortable="true" data-class="eq_avg_td">支付订单数<br><span style="font-size: 10px;font-weight: normal;color: #777" id="avg_order">平均：0</span></th>
                    <th data-field="user_num" data-align="left" data-sortable="true">支付用户数</th>
                    <th data-field="after_user_avg" data-align="left" data-sortable="true">折前客单价</th>
                    <th data-field="user_avg" data-align="left" data-sortable="true">客单价</th>
                    <th data-field="num_avg" data-align="left" data-sortable="true">笔单价</th>
                    <th data-field="open_user" data-align="left" data-sortable="true">开门人数</th>
                    <th data-field="open_num" data-align="left" data-sortable="true">开门次数</th>
                    <th data-field="stock_avg" data-align="left" data-sortable="true">动销率</th>
                    <th data-field="order_avg" data-align="left" data-sortable="true">转化率</th>
                </tr>
                </thead>
            </table>

        </div>
    </div>

    <div class="panel-heading">
        <span class="panel-title" style="width: 50%; color: #777;"> 商品销量排行 </span>
    </div>
    <div class="panel-body">
        <div id="config-bodys">
            <table id="config-tables" data-sort-order="desc" data-toggle="table" data-sort-stable="true"  data-url="/report/current/product_table?platform_id=<{$platform_id}>" data-pagination="true" data-side-pagination="server"  data-page-size="30" >
                <thead>
                <tr>
                    <th data-field="key" data-align="left">排名</th>
                    <th data-field="product_name" data-align="left">商品名称</th>
                    <th data-field="sale_num" data-align="left" data-sortable="true" data-order="desc" >销售商品件数</th>
                    <th data-field="sale_money" data-align="left" data-sortable="true">销售总金额</th>
                    <th data-field="order_num" data-align="left" data-sortable="true">支付订单数</th>
                    <th data-field="price" data-align="left" data-sortable="true">售价</th>
                    <th data-field="stock_avg" data-align="left" data-sortable="true" data-class="eq_avg_td">动销率<br><span style="font-size: 10px;font-weight: normal;color: #777" id="avg_product">平均：0%</span></th>

                    <!--<th data-field="img_url" data-align="center">商品主图</th>-->
                </tr>
                </thead>
            </table>

        </div>
    </div>
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
        <div class="modal-dialog" style="width: 90%">
            <div class="modal-content">

            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>


    <div class="modal " id="loadingModal" role="dialog" data-backdrop="static" data-keyboard="false" >
        <div class="vertical-alignment-helper">
            <div class="modal-dialog vertical-align-center">
                <img src="/assets/images/loading.gif" width="20%" height="auto"  >
            </div>
        </div>

    </div>
    <input type="hidden" value="" class="refer_time">
</div>

<script src="https://cityboxadmin.fruitday.com/assets/js/echarts.js"></script>
<script>
    $(document).ready(function(){
        $('#config-table').bootstrapTable({
        }).on('load-success.bs.table', function (e,data) {
            $('#avg_money').text('平均：'+ parseFloat(data.avg_money) );
            $('#avg_order').text('平均：'+ parseFloat(data.avg_order) );
        });

        $('#config-tables').bootstrapTable({
        }).on('load-success.bs.table', function (e,data) {
            $('#avg_product').text('平均：'+ parseFloat(data.avg_product) + '%' );
        });

        $('#search_platform_id').change(function(){
            location.href='/report/current?platform_id='+$(this).val();
        })

    });

    // 基于准备好的dom，初始化echarts实例
    var time    = '<{$hour}>';
    var param   = '<{$param}>';
    var total_param = '<{$total_param}>';

    var myChart = echarts.init(document.getElementById('main'));
    // 指定图表的配置项和数据
    var option = {
        title: {
            subtext:'支付金额(¥)',
            subtextStyle:{
                fontSize:8,
                color:'#aaa',
                fontWeight:'normal'
            }
        },
        tooltip: {
            trigger: 'axis',
//            formatter: '{b0}时<br/>{a0}: {c0}<br />{a1}: {c1}'
        },
        legend: {
            data:['实时单小时统计', '昨日同期单小时统计', '上周1-5单小时平均值']
        },
        grid: {
            left: '3%',
            right: '4%',
            bottom: '3%',
            containLabel: true
        },
        xAxis: {
            type: 'category',
//            boundaryGap: false,
            data: $.parseJSON(time)
        },
        yAxis: {
            type: 'value',
        },
        series: $.parseJSON(param)
    };

    // 使用刚指定的配置项和数据显示图表。
    myChart.setOption(option);




    var myChart2 = echarts.init(document.getElementById('main2'));

    // 指定图表的配置项和数据
    var option2 = {
        title: {
            subtext:'支付金额(¥)',
            subtextStyle:{
                fontSize:8,
                color:'#aaa',
                fontWeight:'normal'
            }
        },
        tooltip: {
            trigger: 'axis',
        },
        legend: {
            data:['实时累计', '昨日同期累计', '上周1-5累计平均值']
        },
        grid: {
            left: '3%',
            right: '4%',
            bottom: '3%',
            containLabel: true
        },
        xAxis: {
            type: 'category',
//            boundaryGap: false,
            data: $.parseJSON(time)
        },
        yAxis: {
            type: 'value',
        },
        series: $.parseJSON(total_param)
    };

    // 使用刚指定的配置项和数据显示图表。
    myChart2.setOption(option2);

    $('#show_refer').click(function(){
        var pd =$(".refer_time").val();
        $.ajax({
            url: '/report/current/show_refer',
            data: {pd:pd},
            type: 'POST',
            dataType: 'json',
            success: function (data) {
                $(".modal-content").html(data.html);
                $('#myModal').modal('show')
            }
        });
    });
</script>